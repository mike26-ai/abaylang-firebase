# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

# The version of the App Hosting runtime.
# We recommend using the latest major version.
runtime: nodejs20 # Or nodejs20, depending on your Next.js version and preferences

# buildSteps allows you to install dependencies and build your static assets.
# These commands are executed on the server during every new deployment.
# Npm is used by default, but you can specify pnpm or yarn via packageManager.
buildSteps:
  - run: npm install 
  - run: npm run build 

# Settings for the server that serves your app.
# https://firebase.google.com/docs/app-hosting/configure#server-settings
runConfig:
  # App Hosting uses Cloud Run instances to run your application.
  # You can specify the CPU and memory of these instances.
  # Default: 0.5 CPU, 512MiB memory
  # cpu: 1
  # memoryMiB: 1024
  # The maximum number of instances that can be started to handle requests.
  # Default: 100
  maxInstances: 2 # Keep low for MVP / cost control, adjust based on traffic
  # The minimum number of instances that will be kept warm to reduce cold starts.
  # Default: 0
  # minInstances: 0
  # The number of concurrent requests an instance can receive.
  # Default: 80
  # concurrency: 80

# Defines environment variables that will be available at build time and runtime.
# https://firebase.google.com/docs/app-hosting/configure#environment-variables
env:
  # --- Public Variables ---
  - variable: NEXT_PUBLIC_ADMIN_EMAIL
    value: "mahdernmamo@gmail.com"
  - variable: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
    value: "YOUR_RECAPTCHA_SITE_KEY_HERE"
  
  # --- Optional Public Variables for Image Uploads ---
  # These are only required if you want to enable the optional Cloudinary image upload feature.
  - variable: NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME
    value: "YOUR_CLOUD_NAME_HERE"
  - variable: NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET
    value: "YOUR_UPLOAD_PRESET_HERE"
  
  # --- Server-Side Secrets ---
  # These are now securely referenced from Google Cloud Secret Manager.
  # The values are retrieved during runtime.
  - variable: PADDLE_API_KEY
    secret: PADDLE_API_KEY
  - variable: PADDLE_WEBHOOK_SECRET
    secret: PADDLE_WEBHOOK_SECRET
  
  # --- Firebase Admin Secrets (Linked to Secret Manager) ---
  - variable: ADMIN_FIREBASE_PROJECT_ID
    secret: ADMIN_FIREBASE_PROJECT_ID
  - variable: ADMIN_FIREBASE_CLIENT_EMAIL
    secret: ADMIN_FIREBASE_CLIENT_EMAIL
  - variable: ADMIN_FIREBASE_PRIVATE_KEY
    secret: ADMIN_FIREBASE_PRIVATE_KEY
  # --- Optional Server-Side Secrets for Image Uploads ---
  # Uncomment the following lines and create the corresponding secrets in Google
  # Secret Manager if you want to enable the optional Cloudinary image upload feature.
  # - variable: CLOUDINARY_API_KEY
  #   secret: CLOUDINARY_API_KEY
  # - variable: CLOUDINARY_API_SECRET
  #   secret: CLOUDINARY_API_SECRET
  
