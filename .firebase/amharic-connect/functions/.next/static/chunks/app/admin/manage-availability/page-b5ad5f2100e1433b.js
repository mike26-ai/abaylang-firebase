(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2405],{94484:function(e,t,a){Promise.resolve().then(a.bind(a,93041))},93041:function(e,t,a){"use strict";a.d(t,{TimeOffManager:function(){return S}});var s=a(57437),l=a(2265),n=a(87640),r=a(51601),i=a(2933),d=a(49354),o=a(89733);function c(e){let{className:t,classNames:a,showOutsideDays:l=!0,...c}=e;return(0,s.jsx)(i._W,{showOutsideDays:l,className:(0,d.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,o.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,o.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(n.Z,{className:(0,d.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.Z,{className:(0,d.cn)("h-4 w-4",t),...a})}},...c})}c.displayName="Calendar";var u=a(48185),m=a(86763),f=a(87786),h=a(28420),x=a(76538),b=a(21900),g=a(54461),v=a(60364),p=a(83816),y=a(91892),j=a(3425),w=a(83884),k=a(87992),N=a(921);let _=(()=>{let e=[],t=new Date;for(let a=0;a<24;a++)for(let s=0;s<60;s+=30)e.push((0,h.WU)(new Date(t.setHours(a,s,0,0)),"HH:mm"));return e})();function S(){let{user:e,isAdmin:t}=(0,f.a)(),{toast:a}=(0,m.pm)(),[n,r]=(0,l.useState)(new Date),[i,d]=(0,l.useState)({bookings:[],timeOff:[]}),[o,S]=(0,l.useState)(!0),[C,D]=(0,l.useState)(null),[M,O]=(0,l.useState)(null),H="MahderNegashMamo",T=async e=>{S(!0),O(null);try{let t=await (0,w.lm)(e);d(t)}catch(e){console.error("Could not fetch available slots:",e),O("Could not fetch available slots. Please try again."),a({title:"Error",description:e.message||"Could not fetch schedule data.",variant:"destructive"})}finally{S(!1)}};(0,l.useEffect)(()=>{if(!n){S(!1);return}T(n)},[n,H]);let Z=(0,l.useMemo)(()=>{if(!n)return[];let e=new Date,t=(0,x.X)((0,b.b)(n),(0,b.b)(e)),a=[];for(let e of _){let s=(0,b.b)(n),l=(0,g.Qc)(e,"HH:mm",s),r=(0,v.m)(l,30);if(t&&(0,p.C)(l))continue;let d=i.bookings.find(e=>{if(!e.startTime||!e.endTime)return!1;let t=new Date(e.startTime);return l<new Date(e.endTime)&&r>t}),o=i.timeOff.find(e=>{let t=new Date(e.startISO);return l<new Date(e.endISO)&&r>t}),c="available";d&&(c="booked"),o&&(c="blocked"),a.push({value:e,display:"".concat(e," - ").concat((0,h.WU)(r,"HH:mm")),status:c,bookedMeta:d,blockedMeta:o,isAdminView:!0})}return a},[n,i]),B=async s=>{var l;if(n&&e&&t&&!C){if("booked"===s.status){a({title:"Slot Booked",description:"Cannot block a slot that is already booked by a student.",variant:"default"});return}if(D(s.value),"available"===s.status)try{let e=(0,g.Qc)("".concat((0,h.WU)(n,"yyyy-MM-dd")," ").concat(s.value),"yyyy-MM-dd HH:mm",new Date),t=e.toISOString(),l=(0,v.m)(e,30).toISOString();await (0,w.Pj)({tutorId:H,startISO:t,endISO:l,note:"Admin Block"}),a({title:"Slot Blocked",description:"Time slot ".concat(s.display," has been marked as unavailable.")}),n&&await T(n)}catch(e){a({title:"Blocking Failed",description:e.message||"Could not block the time slot.",variant:"destructive"})}if("blocked"===s.status&&(null===(l=s.blockedMeta)||void 0===l?void 0:l.id))try{await (0,w.p2)({timeOffId:s.blockedMeta.id}),a({title:"Slot Unblocked",description:"Time slot ".concat(s.display," is now available.")}),n&&await T(n)}catch(e){a({title:"Unblocking Failed",description:e.message||"Could not unblock the time slot.",variant:"destructive"})}D(null)}};return(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"md:col-span-1",children:(0,s.jsxs)(u.Zb,{className:"shadow-xl sticky top-24",children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsx)(u.ll,{children:"Select a Date"}),(0,s.jsx)(u.SZ,{children:"View and manage the schedule for a specific day."})]}),(0,s.jsx)(u.aY,{className:"flex justify-center",children:(0,s.jsx)(c,{mode:"single",selected:n,onSelect:r,className:"rounded-md border p-0",disabled:e=>(0,p.C)(e)&&!(0,x.X)((0,b.b)(e),(0,b.b)(new Date))})})]})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsxs)(u.Zb,{className:"shadow-xl",children:[(0,s.jsxs)(u.Ol,{children:[(0,s.jsxs)(u.ll,{children:["Time Slots for ",n?(0,h.WU)(n,"PPP"):"..."]}),(0,s.jsx)(u.SZ,{children:"Click a slot to toggle its availability. Blue slots are student lessons."})]}),(0,s.jsx)(u.aY,{children:o?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(y.$,{size:"lg"})}):M?(0,s.jsxs)(k.bZ,{variant:"destructive",children:[(0,s.jsx)(k.Cd,{children:"Error"}),(0,s.jsx)(k.X,{children:M})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(k.bZ,{className:"mb-6",children:[(0,s.jsx)(N.Z,{className:"h-4 w-4"}),(0,s.jsx)(k.Cd,{children:"How to Manage"}),(0,s.jsx)(k.X,{children:(0,s.jsxs)("ul",{className:"list-disc list-inside text-xs space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-semibold text-foreground",children:"Available (White):"})," Click to block this slot."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-semibold text-foreground",children:"Busy (Red):"})," Click to make this slot available again."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("span",{className:"font-semibold text-foreground",children:"Booked (Blue):"})," This is a student's lesson and cannot be changed here."]})]})})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Z.map(e=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(j.Y,{...e,onClick:B}),C===e.value&&(0,s.jsx)("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center rounded-md",children:(0,s.jsx)(y.$,{size:"sm"})})]},e.value))})]})})]})})]})}},87992:function(e,t,a){"use strict";a.d(t,{Cd:function(){return o},X:function(){return c},bZ:function(){return d}});var s=a(57437),l=a(2265),n=a(13027),r=a(49354);let i=(0,n.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),d=l.forwardRef((e,t)=>{let{className:a,variant:l,...n}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,r.cn)(i({variant:l}),a),...n})});d.displayName="Alert";let o=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("h5",{ref:t,className:(0,r.cn)("mb-1 font-medium leading-none tracking-tight",a),...l})});o.displayName="AlertTitle";let c=l.forwardRef((e,t)=>{let{className:a,...l}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("text-sm [&_p]:leading-relaxed",a),...l})});c.displayName="AlertDescription"}},function(e){e.O(0,[4358,139,6244,537,54,3959,5510,3498,2765,1199,65,9997,2971,7023,1744],function(){return e(e.s=94484)}),_N_E=e.O()}]);