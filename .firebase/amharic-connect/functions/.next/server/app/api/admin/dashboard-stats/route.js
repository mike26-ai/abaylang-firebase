"use strict";(()=>{var e={};e.id=2029,e.ids=[2029],e.modules={92509:e=>{e.exports=require("firebase-admin")},65877:e=>{e.exports=require("firebase-admin/auth")},12594:e=>{e.exports=require("firebase-admin/firestore")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45644:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>E,requestAsyncStorage:()=>y,routeModule:()=>b,serverHooks:()=>w,staticGenerationAsyncStorage:()=>A});var o={};r.r(o),r.d(o,{GET:()=>v,dynamic:()=>f});var i=r(49303),n=r(88716),a=r(60670),s=r(87070),d=r(82421),c=r(92509),l=r.n(c),u=r(65877),p=r(12594),g=r(16727);(0,d.xH)();let m=(0,u.getAuth)(),h=(0,p.getFirestore)(),f="force-dynamic";async function v(e){try{let t=e.headers.get("Authorization")?.split("Bearer ")[1];if(!t)return s.NextResponse.json({error:"Unauthorized: No authentication token provided."},{status:401});let r=await m.verifyIdToken(t),o=(await h.collection("users").doc(r.uid).get()).data();if(o?.role!=="admin")return s.NextResponse.json({error:"Forbidden: User does not have admin privileges."},{status:403});let i=(0,g.b)(new Date),[n,a,d,c,u,p,f,v,b,y]=await Promise.all([h.collection("bookings").where("status","==","confirmed").get(),h.collection("testimonials").where("status","==","pending").count().get(),h.collection("contactMessages").where("read","==",!1).count().get(),h.collection("users").where("role","==","student").count().get(),h.collection("bookings").where("status","in",["awaiting-payment","payment-pending-confirmation"]).count().get(),h.collection("bookings").orderBy("createdAt","desc").limit(5).get(),h.collection("contactMessages").orderBy("createdAt","desc").limit(5).get(),h.collection("users").where("role","==","student").orderBy("createdAt","desc").limit(5).get(),h.collection("testimonials").where("status","==","pending").orderBy("createdAt","desc").limit(5).get(),h.collection("testimonials").where("status","==","approved").get()]),A=n.docs.filter(e=>{let t=e.data().date;if(!t||"string"!=typeof t)return!1;let r=new Date(t);return!isNaN(r.getTime())&&r>=i}).length,w=y.docs.map(e=>e.data().rating),x=w.length>0?w.reduce((e,t)=>e+t,0)/w.length:0,E={upcomingBookings:A,pendingTestimonialsCount:a.data().count,newInquiries:d.data().count,totalStudents:c.data().count,newBookingsCount:u.data().count,totalRevenue:1250,averageRating:x},I=e=>e.map(e=>{let t=e.data(),r={id:e.id};for(let e in t)t[e]instanceof l().firestore.Timestamp?r[e]=t[e].toDate().toISOString():r[e]=t[e];return r}),R={stats:E,recentBookings:I(p.docs),pendingTestimonials:I(b.docs),recentMessages:I(f.docs),recentStudents:I(v.docs)};return s.NextResponse.json(R)}catch(e){if(console.error("API Error (/api/admin/dashboard-stats):",e),"auth/id-token-expired"===e.code)return s.NextResponse.json({error:"Authentication token has expired. Please log in again."},{status:401});if("auth/argument-error"===e.code)return s.NextResponse.json({error:"Invalid authentication token provided."},{status:401});return s.NextResponse.json({error:"Failed to fetch dashboard statistics.",details:e.message},{status:500})}}let b=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/dashboard-stats/route",pathname:"/api/admin/dashboard-stats",filename:"route",bundlePath:"app/api/admin/dashboard-stats/route"},resolvedPagePath:"/home/user/studio/src/app/api/admin/dashboard-stats/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:y,staticGenerationAsyncStorage:A,serverHooks:w}=b,x="/api/admin/dashboard-stats/route";function E(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:A})}},82421:(e,t,r)=>{r.d(t,{CZ:()=>d,EK:()=>n,iW:()=>s,xH:()=>a});var o=r(92509),i=r.n(o);let n=i().firestore.Timestamp;function a(){if(i().apps.length>0)return i().app();let e={projectId:process.env.FIREBASE_PROJECT_ID,clientEmail:process.env.FIREBASE_CLIENT_EMAIL,privateKey:(process.env.FIREBASE_PRIVATE_KEY||"").replace(/\\n/g,"\n")};if(!e.projectId||!e.clientEmail||!e.privateKey){let e="CRITICAL: Firebase Admin SDK credentials are not set correctly in environment variables. Check your .env file or hosting configuration.";throw console.error(e),Error(e)}try{let t=i().initializeApp({credential:i().credential.cert(e)});return console.log("Firebase Admin SDK initialized successfully."),t}catch(e){if(console.error("CRITICAL: Firebase admin initialization error:",e.message),"app/invalid-credential"===e.code)throw Error("Could not initialize Firebase Admin SDK. The provided credentials are invalid or malformed.");throw Error("Could not initialize Firebase Admin SDK. Please check server logs for details.")}}a();let s=i().firestore(),d=i().auth()},16727:(e,t,r)=>{r.d(t,{b:()=>i});var o=r(79109);function i(e){let t=(0,o.Q)(e);return t.setHours(0,0,0,0),t}},79109:(e,t,r)=>{function o(e){let t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):new Date("number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?e:NaN)}r.d(t,{Q:()=>o})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,5972],()=>r(45644));module.exports=o})();